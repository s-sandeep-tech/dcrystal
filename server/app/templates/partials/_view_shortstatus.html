<table class="enterprise-grid w-full text-[11px] border-collapse bg-white dark:bg-gray-900 sticky-header">
    <thead>
        <tr class="bg-gray-50 dark:bg-gray-800/50 text-gray-500 uppercase font-bold text-[9px] tracking-wider">
            <th class="col-division text-left px-2">Division</th>
            <th class="col-group text-left px-2">Group</th>
            <th class="col-purity text-center px-1">Pur</th>
            <th class="col-classification text-left px-2">Class</th>
            <th class="col-make text-left px-2">Make</th>
            <th class="col-collection text-left px-2">Coll</th>
            <th class="col-section text-center px-2">Sec</th>
            <th class="col-type text-center px-2">Type</th>
            <th class="col-weight text-right px-2">Weight</th>
            <th class="col-total bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white">Total</th>
        </tr>
    </thead>
    <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
        {% for r in rows %}
        <tr class="parent-row hover:bg-blue-50/30 group">
            <td class="font-medium px-2">{{ r.division }}</td>
            <td class="px-2">{{ r.group_name }}</td>
            <td class="text-center px-1">{{ r.purity }}</td>
            <td class="px-2">{{ r.classification }}</td>
            <td class="px-2">{{ r.make_location }}</td>
            <td class="px-2">{{ r.collection }}</td>
            <td class="text-center px-2">{{ r.section }}</td>
            <td class="text-center px-2">{{ r.product_type }}</td>
            <td class="text-right px-2 font-mono">{{ "%.3f"|format(r.weight|float) }}</td>
            <td class="col-total font-bold bg-gray-50/50 text-right">{{ r.total_count }}</td>
        </tr>
        {% endfor %}
        {% if not rows %}
        <tr>
            <td colspan="10" class="py-12 text-center text-gray-400 font-bold uppercase tracking-widest">No data
                matching filters</td>
        </tr>
        {% endif %}
    </tbody>
    <tfoot class="sticky-footer">
        <tr class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white uppercase text-[9px]">
            <td class="p-2 text-right" colspan="9">Grand Total Load</td>
            <td class="col-total bg-gray-200 dark:bg-gray-700 text-right">{{ footer_totals.total or '0' }}</td>
        </tr>
    </tfoot>
</table>

<!-- Pagination Controls (Design Matching) -->
<div
    class="px-3 py-1.5 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 flex items-center justify-between sticky bottom-0">
    <div></div> <!-- Spacer -->
    <div class="flex items-center gap-4 text-[10px] text-gray-500">
        <div class="flex items-center gap-2">
            <span class="text-gray-400">Rows per page:</span>
            <select id="per-page-select" onchange="applyFilters()"
                class="bg-transparent border-none text-[10px] font-bold text-gray-700 dark:text-gray-300 focus:ring-0 p-0 cursor-pointer">
                <option value="50" {% if pagination and pagination.per_page==50 %}selected{% endif %}>50</option>
                <option value="100" {% if pagination and pagination.per_page==100 %}selected{% endif %}>100</option>
                <option value="200" {% if pagination and pagination.per_page==200 %}selected{% endif %}>200</option>
            </select>
        </div>
        <div class="h-3 w-px bg-gray-200 dark:bg-gray-700"></div>
        <span class="font-medium text-gray-700 dark:text-gray-300">
            {% if pagination %}
            {{ (pagination.page - 1) * pagination.per_page + 1 }}-{{ [pagination.page * pagination.per_page,
            pagination.total]|min }} of {{ pagination.total }}
            {% else %}
            0-0 of 0
            {% endif %}
        </span>
        <div class="flex items-center gap-1">
            <button onclick="changePage({{ pagination.prev_num }})" {% if not pagination or not pagination.has_prev
                %}disabled{% endif %}
                class="p-0.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded text-gray-400 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                <span class="material-symbols-outlined text-[16px]">chevron_left</span>
            </button>
            <button onclick="changePage({{ pagination.next_num }})" {% if not pagination or not pagination.has_next
                %}disabled{% endif %}
                class="p-0.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded text-gray-400 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                <span class="material-symbols-outlined text-[16px]">chevron_right</span>
            </button>
        </div>
    </div>
</div>

<div class="pagination-meta hidden" data-page="{{ pagination.page if pagination else 1 }}"
    data-total="{{ pagination.total if pagination else 0 }}">
</div>
<script id="stats-metadata" type="application/json">
    {{ stats | tojson }}
</script>